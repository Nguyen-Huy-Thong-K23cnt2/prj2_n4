@model VanPhongPhamDKT.Models.DonHang
@{
    Layout = null; /* nếu muốn dùng layout chung, thay = "~/Views/Shared/_Layout.cshtml" */
    var title = $"Sửa đơn hàng #{Model?.MaDh}";
    string? ngayDatValue = Model?.NgayDat.HasValue == true
        ? Model.NgayDat.Value.ToString("yyyy-MM-ddTHH:mm")
        : null;

    var statuses = new[] { "Mới", "Chờ duyệt", "Đang giao", "Hoàn tất", "Đã hủy" };
}
<link rel="stylesheet" href="~/css/donhang.css" asp-append-version="true" />
<div class="site-bg--donhang"></div>

<div class="container mt-4 dh-page">
    <!-- Header -->
    
    <!-- Card/Form -->
    <div class="dh-card">
        <div class="p-3 p-md-4">
            <form asp-action="Edit"
                  asp-route-id="@Model.MaDh"
                  method="post"
                  class="needs-validation" novalidate>
                @Html.AntiForgeryToken()

                <div asp-validation-summary="ModelOnly" class="dh-form-error"></div>
                <input asp-for="MaDh" type="hidden" />

                <!-- Lưới 2 cột theo CSS -->
                <div class="dh-form-grid">
                    <!-- Khách hàng -->
                    <div class="dh-field">
                        <label asp-for="MaKh" class="form-label">Khách hàng</label>
                        <select asp-for="MaKh" class="form-select" asp-items="ViewBag.MaKh" required>
                            <option value="">-- Chọn khách hàng --</option>
                        </select>
                        <span asp-validation-for="MaKh" class="dh-field-error"></span>
                    </div>

                    <!-- Ngày đặt -->
                    <div class="dh-field">
                        <label asp-for="NgayDat" class="form-label">Ngày đặt</label>
                        <input type="datetime-local" name="NgayDat" class="form-control" value="@ngayDatValue" />
                        <span asp-validation-for="NgayDat" class="dh-field-error"></span>
                    </div>

                    <!-- Tổng tiền -->
                    <div class="dh-field">
                        <label asp-for="TongTien" class="form-label">Tổng tiền</label>
                        <div class="input-group dh-money">
                            <input asp-for="TongTien" asp-format="{0:0}" type="number" step="1" min="0" inputmode="numeric"
                                   class="form-control" placeholder="0" />
                            <span class="input-group-text">đ</span>
                        </div>
                        <span asp-validation-for="TongTien" class="dh-field-error"></span>
                    </div>

                    <!-- Trạng thái -->
                    <div class="dh-field">
                        <label asp-for="TrangThai" class="form-label">Trạng thái</label>
                        <select asp-for="TrangThai" class="form-select">
                            <option value="">-- Chọn trạng thái --</option>
                            @foreach (var s in statuses)
                            {
                                <option value="@s" selected="@(string.Equals(Model?.TrangThai, s, StringComparison.OrdinalIgnoreCase))">@s</option>
                            }
                        </select>
                        <span asp-validation-for="TrangThai" class="dh-field-error"></span>
                    </div>
                </div>

                <!-- Thanh action dính đáy card -->
                <div class="dh-actions dh-actions--bar">
                    <a asp-action="Index" class="btn dh-btn-cancel">Hủy</a>
                    <button type="submit" class="btn dh-btn-primary">Lưu thay đổi</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (() => {
            'use strict';
            const forms = document.querySelectorAll('.needs-validation');
            for (const form of forms) {
                form.addEventListener('submit', e => {
                    if (!form.checkValidity()) { e.preventDefault(); e.stopPropagation(); }
                    form.classList.add('was-validated');
                });
            }
        })();
    </script>
}
