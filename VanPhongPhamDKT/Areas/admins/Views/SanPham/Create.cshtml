@model VanPhongPhamDKT.Models.SanPham
@{
    ViewData["Title"] = "Thêm sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/sanpham.css" asp-append-version="true" />
<div class="site-bg--sanpham"></div>  @* nếu bạn đang dùng nền này cho list, tái sử dụng luôn *@

<div class="sp-create-page container mt-4">
    <h2 class="sp-title mb-3"><i class="fa-solid fa-plus"></i> Thêm sản phẩm mới</h2>

    <form asp-action="Create" method="post" enctype="multipart/form-data" class="sp-form-glass">
        @Html.AntiForgeryToken()

        <div asp-validation-summary="ModelOnly" class="sp-form-error mb-2"></div>
        @if (ViewBag.ModelErrors != null)
        {
            <div class="alert alert-danger">@ViewBag.ModelErrors</div>
        }

        <!-- Tên SP -->
        <div class="mb-3">
            <label asp-for="TenSp" class="form-label"></label>
            <input asp-for="TenSp" class="form-control" placeholder="Bìa kẹp tài liệu…" />
            <span asp-validation-for="TenSp" class="sp-field-error"></span>
        </div>

        <!-- Giá -->
        <div class="mb-3">
            <label asp-for="Gia" class="form-label"></label>
            <input asp-for="Gia" class="form-control" type="number" step="1000" min="0" placeholder="0" />
            <span asp-validation-for="Gia" class="sp-field-error"></span>
        </div>

        <!-- Số lượng -->
        <div class="mb-3">
            <label asp-for="SoLuong" class="form-label"></label>
            <input asp-for="SoLuong" class="form-control" type="number" step="1" min="0" />
            <span asp-validation-for="SoLuong" class="sp-field-error"></span>
        </div>

        <!-- Ảnh + preview -->
        <div class="mb-3 sp-image-field">
            <label class="form-label">Hình ảnh</label>
            <input type="file" name="HinhAnhFile" class="form-control" accept="image/*" id="spImageInput" />
            <span class="sp-field-note">PNG/JPG ≤ 5MB</span>
            <div class="sp-image-preview">
                <img id="spImagePreview" alt="Xem trước" />
            </div>
            <span class="text-danger">@ViewBag.FileError</span>
        </div>

        <!-- Danh mục -->
        <div class="mb-3">
            <label asp-for="MaDm" class="form-label"></label>
            <select asp-for="MaDm" asp-items="ViewBag.MaDm" class="form-select" required>
                <option value="">-- Chọn danh mục --</option>
            </select>
            <span asp-validation-for="MaDm" class="sp-field-error"></span>
        </div>

        <!-- Mô tả -->
        <div class="mb-3 sp-col-full">
            <label asp-for="MoTa" class="form-label"></label>
            <textarea asp-for="MoTa" class="form-control" rows="3" placeholder="Mô tả ngắn…"></textarea>
            <span asp-validation-for="MoTa" class="sp-field-error"></span>
        </div>

        <!-- Actions -->
        <div class="sp-actions">
            <button type="submit" class="btn sp-btn-primary">
                <i class="fa-solid fa-save"></i> Lưu
            </button>
            <a asp-action="Index" class="btn sp-btn-cancel">Quay lại</a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Preview ảnh ngay khi chọn
        const input = document.getElementById('spImageInput');
        const img   = document.getElementById('spImagePreview');
        if (input && img) {
            input.addEventListener('change', e => {
                const f = e.target.files?.[0];
                if (!f) { img.src = ''; img.style.display = 'none'; return; }
                img.src = URL.createObjectURL(f);
                img.onload = () => URL.revokeObjectURL(img.src);
                img.style.display = 'block';
            });
        }
    </script>
}
